{% extends "base.html" %}
<br>
{% block content %}
<h2>{{ user }}'s Stats</h2>
<div style="display:flex;gap:4em;align-items:center;">
  <!-- Win% bar -->
  <div style="flex:1;">
    <div class="stats-block">
      <div class="stat-label">Win %</div>
      <div class="progress-bar-outer">
        <div class="progress-bar-inner" style="width: {{ win_rate }}%;"></div>
      </div>
      <div class="stat-value">{{ win_rate }}%</div>
    </div>
  </div>
  <!-- Streak circle -->
  <div class="streak-circle-box">
    <svg width="65" height="65" viewBox="0 0 65 65">
      <circle cx="32.5" cy="32.5" r="28" fill="#142850" stroke="#444" stroke-width="5"/>
      <circle cx="32.5" cy="32.5" r="28" fill="none"
        stroke="#C4FF0E"
        stroke-width="6"
        stroke-dasharray="176"
        stroke-dashoffset="{{ 176 - (current_streak/10*176)}}"
        stroke-linecap="round"/>
      <text x="32.5" y="39" text-anchor="middle" fill="#C4FF0E" font-size="24" font-family="Montserrat" font-weight="bold">{{ current_streak }}</text>
    </svg>
    <div class="streak-label">Current Streak</div>
  </div>
  <!-- Achievements -->
  <div>
    <div class="badges-row">
      ... (badge icons logic here) ...
    </div>
    <div style="font-size:.88em;margin-top:4px;">Achievements</div>
  </div>
</div>
<hr>

<!-- Picks Table Section -->
<h3>Your Picks</h3>
{% if picks %}
<table style="width:100%;border-collapse:collapse;">
  <tr>
    <th>Game</th>
    <th>Winner</th>
    <th>O/U Pick</th>
    <th>Date Picked</th>
    <th>Final Score</th>
    <th>Result</th>
  </tr>
  {% for pick in picks %}
  <tr>
    <td>{{ pick.short_name }}</td>
    <td>{{ pick.pick_winner }}</td>
    <td>{{ pick.pick_total }}</td>
    <td>{{ pick.made_at }}</td>
    <td>
      {% if pick.final_home_score is not none and pick.final_away_score is not none %}
        {{ pick.final_home_score }}-{{ pick.final_away_score }}
      {% else %}
        Pending
      {% endif %}
    </td>
    <td>
      {% if pick.is_final %}
        {% set actual_winner = 'home' if pick.final_home_score > pick.final_away_score else 'away' %}
        {% set total_points = (pick.final_home_score or 0) + (pick.final_away_score or 0) %}
        {% set ou_result = 'over' if total_points > (pick.over_under or 0) else 'under' %}
        {% if pick.pick_winner == actual_winner and pick.pick_total == ou_result %}
          ✔️
        {% else %}
          ❌
        {% endif %}
      {% else %}
        Pending
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No picks yet.</p>
{% endif %}

{% endblock %}
